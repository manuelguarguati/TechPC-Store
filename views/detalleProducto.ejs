<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= producto.name %> - TechPC Store</title>
  <link rel="icon" href="/img/favicon.ico" />
  <link rel="stylesheet" href="../css/productoDetalle.css">
</head>

<body>
  <header>
    <div class="header-left">
      <a href="/home">ğŸ  TechPC Store</a>
    </div>
    <div class="header-center">
      <input type="text" id="busqueda" placeholder="Buscar productos...">
      <button id="buscar-btn">ğŸ”</button>
    </div>
    <div class="header-right">
      <% if(usuario){ %>
        <span>Hola, <%= usuario.name %></span>
        <button id="logout-btn">Cerrar sesiÃ³n</button>
      <% } else { %>
        <a href="/login">Ingresar</a>
        <a href="/registro">Registrarse</a>
      <% } %>
      <a href="/carrito">
        <button id="carrito-btn">ğŸ›’ (<%= miniCarrito?.cantidad || 0 %>)</button>
      </a>
    </div>
  </header>

  <main data-id="<%= producto.id %>">
    <div class="detalle-producto">
      <div class="imagenes">
        <img id="img-principal" src="<%= producto.image_url %>" alt="<%= producto.name %>">
        <% if(producto.imagenes && producto.imagenes.length > 0){ %>
          <div class="miniaturas">
            <% producto.imagenes.forEach(img => { %>
              <img class="miniatura" src="<%= img %>" alt="Miniatura">
            <% }) %>
          </div>
        <% } %>
      </div>

      <div class="info-producto">
        <h1><%= producto.name %></h1>
        <p class="precio">$<%= parseFloat(producto.price).toLocaleString() %></p>
        <p class="envio"><%= producto.envio_gratis ? "EnvÃ­o GRATIS" : "EnvÃ­o NO gratis" %></p>
        <p class="descripcion"><strong>DescripciÃ³n:</strong> <%= producto.description || "Sin descripciÃ³n" %></p>
        
        <h3>CaracterÃ­sticas:</h3>
        <ul class="caracteristicas">
          <% if(producto.detalles && producto.detalles.length > 0){ %>
            <% producto.detalles.forEach(d => { %>
              <li><strong><%= d.key_detail %>:</strong> <%= d.value_detail %></li>
            <% }) %>
          <% } else { %>
            <li>Sin caracterÃ­sticas adicionales</li>
          <% } %>
        </ul>

        <p class="stock"><strong>Stock:</strong> <%= producto.stock %></p>

        <div class="acciones">
          <input type="number" id="cantidad" value="1" min="1" max="<%= producto.stock %>">
          <button id="agregar-carrito" data-id="<%= producto.id %>">AÃ±adir al carrito ğŸ›’</button>
        </div>
      </div>
    </div>

    <section class="productos-relacionados">
      <h2>TambiÃ©n te puede interesar</h2>
      <div id="relacionados" data-id="<%= producto.id %>"></div>
    </section>

    <section class="reviews-section">
      <h2>Opiniones de clientes</h2>
      <div id="promedio"></div>
      <div id="reviews-container"></div>

      <% if (usuario) { %>
        <form id="reviewForm">
          <label>Tu calificaciÃ³n:</label>
          <div class="stars">
            <% for (let i = 1; i <= 5; i++) { %>
              <span class="star" data-value="<%= i %>">â˜…</span>
            <% } %>
          </div>
          <input type="hidden" name="calificacion" id="calificacion" value="0">
          <textarea id="comentario" name="comentario" placeholder="Escribe tu reseÃ±a..." required></textarea>
          <button type="submit">Enviar reseÃ±a</button>
        </form>
      <% } else { %>
        <p><a href="/login">Inicia sesiÃ³n</a> para dejar una reseÃ±a.</p>
      <% } %>
    </section>
  </main>

  <footer>Â© TechPC Store 2025</footer>

  <script type="module" src="/scripts/DetalleProducto.js"></script>
  <script type="module" src="/scripts/review.js"></script>
</body>
</html>
